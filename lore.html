<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciando Secuencia...</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Special+Elite&family=VT323&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #a8ffbe; --background-color: #0d1a14;
            --glow-color: rgba(168, 255, 190, 0.5);
        }
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; background-color: var(--background-color); color: var(--primary-color); font-family: 'VT323', monospace; cursor: pointer; }
        
        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        #vignette { box-shadow: inset 0 0 25vmin rgba(0,0,0,0.8); }
        .crt-effect::after {
            content: " "; display: block; position: absolute; top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 4px, 3px 100%;
            z-index: 11; pointer-events: none;
            animation: flicker 0.15s infinite;
        }
        @keyframes flicker { 0% { opacity: 0.21; } 5% { opacity: 0.34; } 10% { opacity: 0.23; } 15% { opacity: 0.45; } 20% { opacity: 0.31; } 25% { opacity: 0.5; } 30% { opacity: 0.24; } 35% { opacity: 0.41; } 40% { opacity: 0.28; } 45% { opacity: 0.33; } 50% { opacity: 0.48; } 55% { opacity: 0.29; } 60% { opacity: 0.42; } 65% { opacity: 0.3; } 70% { opacity: 0.5; } 75% { opacity: 0.35; } 80% { opacity: 0.4; } 85% { opacity: 0.22; } 90% { opacity: 0.39; } 95% { opacity: 0.47; } 100% { opacity: 0.31; } }
        
        body.theme-amber { --primary-color: #ffc254; --background-color: #1a1100; --glow-color: rgba(255, 194, 84, 0.5); }
        body.theme-blue { --primary-color: #82eaff; --background-color: #03131a; --glow-color: rgba(130, 234, 255, 0.5); }
        
        .lore-container {
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            width: 100%; height: 100%; text-align: center; padding: 20px; box-sizing: border-box;
        }
        #lore-text {
            font-size: 2.5rem; max-width: 800px;
            text-shadow: 0 0 5px var(--glow-color);
            opacity: 0;
            animation: fade-in 1s forwards;
        }
        #continue-prompt {
            position: absolute; bottom: 40px; font-size: 1.5rem; opacity: 0.6;
            animation: blink 1.5s step-end infinite;
        }

        @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
        @keyframes blink { 50% { opacity: 0; } }

        @media (max-width: 768px) {
            #lore-text { font-size: 1.8rem; }
            #continue-prompt { font-size: 1.2rem; }
        }
    </style>
</head>
<body>
    <div id="vignette" class="overlay"></div>
    <div class="lore-container">
        <p id="lore-text"></p>
        <p id="continue-prompt">( Toca para continuar )</p>
    </div>

    <script>
        const loreTextElement = document.getElementById('lore-text');
        const continuePrompt = document.getElementById('continue-prompt');

        // --- LORE DEL JUEGO ---
        const lore_es = [
            "Año 2077. La Red ya no es un lugar. Es EL lugar.",
            "Mega-corporaciones amurallaron sus sectores, creando fronteras digitales.",
            "Tú eres un guardián del 'Protocolo de Acceso', la única puerta de entrada neutral que queda.",
            "Cada conexión, cada paquete de datos, debe ser verificado.",
            "Un error podría significar la infiltración. El colapso.",
            "Tu deber comienza ahora. Presta atención a los detalles. No confíes en nadie."
        ];
        
        const lore_en = [
            "Year 2077. The Net is no longer a place. It is THE place.",
            "Mega-corporations walled off their sectors, creating digital frontiers.",
            "You are a guardian of the 'Access Protocol', the only neutral gateway left.",
            "Every connection, every data packet, must be verified.",
            "One mistake could mean infiltration. Collapse.",
            "Your duty begins now. Pay attention to the details. Trust no one."
        ];

        let lore;
        let loreIndex = 0;
        let slotId;
        let withTutorial;

        // --- FUNCIÓN PARA INICIAR EL JUEGO ---
        function startGame() {
            // Elimina el evento para no poder hacer click de nuevo
            document.removeEventListener('click', advanceLore);
            continuePrompt.style.display = 'none';
            loreTextElement.textContent = "INICIANDO SISTEMA...";

            // Lógica para crear un nuevo juego
            const urlParams = new URLSearchParams(window.location.search);
            const isNewGame = urlParams.has('tutorial'); // Solo las partidas nuevas tienen el parámetro 'tutorial'
            
            if (isNewGame) {
                const savedData = localStorage.getItem('protocoloAccesoGameSaves');
                let gameSaves = savedData ? JSON.parse(savedData) : [null, null, null];
                
                gameSaves[slotId] = { day: 1, money: 100, tutorial: withTutorial };
                localStorage.setItem('protocoloAccesoGameSaves', JSON.stringify(gameSaves));
                
                console.log(`Nueva partida creada en ranura ${slotId + 1} ${withTutorial ? 'CON' : 'SIN'} tutorial.`);
            } else {
                console.log(`Cargando partida desde la ranura ${slotId + 1}...`);
            }

            // Aquí es donde redirigirías a tu página de juego principal (ej: game.html)
            setTimeout(() => {
                alert("¡Lore terminado! Redirigiendo al juego... (Crea un 'game.html' para continuar la experiencia)");
                // window.location.href = `game.html?slot=${slotId}`; // Descomenta esta línea cuando tengas tu página de juego
            }, 2000);
        }

        // --- FUNCIÓN PARA AVANZAR EN EL LORE ---
        function advanceLore() {
            loreIndex++;
            if (loreIndex < lore.length) {
                loreTextElement.style.animation = 'none';
                void loreTextElement.offsetWidth; // Trigger reflow
                loreTextElement.style.animation = 'fade-in 1s forwards';
                loreTextElement.textContent = lore[loreIndex];
            } else {
                startGame();
            }
        }

        // --- INICIALIZACIÓN ---
        document.addEventListener('DOMContentLoaded', () => {
            // Cargar configuración para saber el tema y el idioma
            const savedSettings = localStorage.getItem('protocoloAccesoSettings');
            const settings = savedSettings ? JSON.parse(savedSettings) : { theme: 'green', crt: true, lang: 'es' };
            
            document.body.classList.add(`theme-${settings.theme}`);
            if (settings.crt) document.body.classList.add('crt-effect');
            
            lore = settings.lang === 'en' ? lore_en : lore_es;
            
            // Obtener datos de la URL
            const urlParams = new URLSearchParams(window.location.search);
            slotId = parseInt(urlParams.get('slot'), 10);
            withTutorial = urlParams.get('tutorial') === 'true';

            if (isNaN(slotId)) {
                // Si no hay ranura, volver al menú principal
                window.location.href = 'index.html';
                return;
            }

            loreTextElement.textContent = lore[0];
            document.addEventListener('click', advanceLore);
        });

    </script>
</body>
</html>